package com.efimchick.ifmo.streams.countwords;


import java.util.Arrays;
import java.util.List;
import java.util.Locale;
import java.util.Map;
import java.util.stream.Collectors;

public class Words {

    private static final String punctuationRegex = "\\P{javaLetter}+";

    public static String countWords(List<String> lines) {
        Map<String, Long> wordFrequency = lines.stream()
                .map(line -> line.replaceAll(punctuationRegex, " "))
                .flatMap(line -> Arrays.stream(line.split("\\s")))
                .map(String::toLowerCase)
                .collect(Collectors.groupingBy(word -> word, Collectors.counting()));

        return wordFrequency.keySet().stream()
                .filter(key -> key.length() >= 4)
                .filter(key -> wordFrequency.get(key) >= 10)
                .collect(Collectors.toMap(key -> key, wordFrequency::get)).entrySet().stream()
                .sorted(Map.Entry.<String, Long>comparingByValue().reversed().thenComparing(Map.Entry::getKey))
                .map(entrySet -> String.format("%s - %d\n", entrySet.getKey(), entrySet.getValue()))
                .reduce("", (e1, e2) -> e1 + e2)
                .trim();
    }
}
/* TODO
* 1. ?????? ????? ???? ?? ???????? ???????, ??? ?????? ? ????.
* 2. ???????? ????? ?? ?????????? ??????? ???? ????????? ? ?????.
* 3. ???????????? ????? ?? ?? ?????? ?? ??????? ?? ?????????.
* 4. ??????????? ????? ?? ??????? ????????? ?? ???????.
* 5. ?????? ????????? ? ?????? ? ????????? ??????.
*/